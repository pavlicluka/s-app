# Testing Guide: Evidence obdelav (Processing Activities Record)\n\n## Overview\n\nThis guide documents comprehensive test cases for the \"Evidence obdelav\" (GDPRProcessingActivitiesRecord) table on the GDPR page. The test suite covers CRUD operations, data validation, UI interactions, filtering, sorting, and edge cases.\n\n## Test Files Location\n\n- **Test Cases:** `src/tests/GDPRProcessingActivitiesRecord.test.ts`\n- **Test Examples:** `src/tests/GDPRProcessingActivitiesRecord.examples.ts`\n- **This Guide:** `TESTING_GUIDE.md`\n\n## Test Coverage Summary\n\n### Total Test Cases: 50+\n\n| Category | Count | Status |\n|----------|-------|--------|\n| CREATE Operations | 6 | ✓ Defined |\n| READ Operations | 9 | ✓ Defined |\n| UPDATE Operations | 9 | ✓ Defined |\n| DELETE Operations | 5 | ✓ Defined |\n| TABLE Interactions | 8 | ✓ Defined |\n| FILTER & SORT | 6 | ✓ Defined |\n| EDGE CASES | 7 | ✓ Defined |\n| DATA INTEGRITY | 5 | ✓ Defined |\n| **TOTAL** | **55** | **✓ Defined** |\n\n## Test Data Fixtures\n\nFour realistic test records are provided:\n\n### 1. `validRecord` - Complete Record\n- Full data entry with all fields populated\n- Valid email, dates, and legal basis\n- Active status, no incidents\n- Best for: Standard CRUD testing\n\n### 2. `minimalRecord` - Minimal Required Fields\n- Only required fields populated\n- Empty optional fields (phone, DPO contact, etc.)\n- Useful for testing field validation\n- Best for: Validation and edge case testing\n\n### 3. `withAutomatedDecisions` - Automated Decision Making\n- Contains ML/AI automated decision making\n- Demonstrates AI compliance requirements\n- Multiple data subject requests\n- Best for: Testing conditional fields and complex workflows\n\n### 4. `underReview` - Status Variant\n- Status set to \"under_review\"\n- Contains one data loss incident\n- Temporary retention period\n- Best for: Status-based filtering and business logic\n\n## CREATE Operations Tests\n\n### Test 1: Complete Valid Record\n```javascript\n// Creates a record with all fields populated\n// Validates: All field types, non-empty strings, email format\nExpected: Success with generated ID\n```\n\n### Test 2: Minimal Required Fields\n```javascript\n// Creates record with only required fields\n// Validates: Optional fields can be empty\nExpected: Success, null fields handled gracefully\n```\n\n### Test 3: Missing Required Fields\n```javascript\n// Attempts creation without required fields\n// Validates: controller_name, controller_email, processing_purpose, etc.\nExpected: VALIDATION_ERROR\n```\n\n### Test 4: Invalid Email Format\n```javascript\n// Attempts to create with invalid email\nExpected: INVALID_EMAIL error\nValidation: Email regex pattern matching\n```\n\n### Test 5: Invalid Lawful Basis\n```javascript\n// Attempts invalid lawful_basis value\nValid values: Pogodba, Privolitev, Zakonska obveznost, Zakoniti interes, Nujna potreba, Javni interes\nExpected: INVALID_LAWFUL_BASIS error\n```\n\n### Test 6: Organization Context\n```javascript\n// Verifies organization_id is set from user context\n// Validates: Cross-organization data isolation\nExpected: Record belongs to user's organization\n```\n\n## READ Operations Tests\n\n### Test 1: Fetch All Records\n```javascript\n// Retrieves all records for current organization\nExpected: Array of records ordered by creation date (newest first)\nValidation: Only current org's records returned\n```\n\n### Test 2: Fetch Single Record\n```javascript\n// Retrieves specific record by ID\nExpected: Single record object with all fields\nValidation: All data types preserved\n```\n\n### Test 3: Empty Organization\n```javascript\n// Query non-existent organization\nExpected: Empty array (no data leakage)\nValidation: Security - no cross-org access\n```\n\n### Test 4: Pagination\n```javascript\n// Test limit and offset parameters\nExpected: Correct page size, hasMore indicator\nValidation: Large datasets handled efficiently\n```\n\n### Test 5: Sorting\n```javascript\n// Test orderBy created_at, controller_name, etc.\nExpected: Records sorted correctly (asc/desc)\nValidation: Date and string sorting work correctly\n```\n\n### Test 6-9: Filtering\n```javascript\n// Filter by: status, controller_name, automated_decision_making, etc.\nExpected: Only matching records returned\nValidation: Case-insensitive search, special characters handled\n```\n\n### Test 9: Aggregation\n```javascript\n// Calculate stats: total records, active count, total incidents, total requests\nExpected: Correct math across filtered data\nValidation: SUM() operations accurate\n```\n\n## UPDATE Operations Tests\n\n### Test 1: Single Field Update\n```javascript\nUpdates: status = \"inactive\"\nExpected: Only status changed, other fields preserved\nValidation: Partial updates work correctly\n```\n\n### Test 2: Multiple Field Update\n```javascript\nUpdates: data_loss_incidents, data_subject_requests, review dates\nExpected: All fields updated together\nValidation: Atomic operations\n```\n\n### Test 3-5: Validation Tests\n```javascript\n// Email validation, lawful_basis validation, organization_id protection\nExpected: Invalid updates rejected\nValidation: Business rules enforced\n```\n\n### Test 6: Status Update\n```javascript\nValid statuses: active, inactive, under_review, suspended\nExpected: Status changes correctly, stats update\nValidation: Status transitions allowed\n```\n\n### Test 7: Metadata Preservation\n```javascript\nExpected: created_at doesn't change, id remains constant\nValidation: Immutable fields protected\n```\n\n### Test 8: Automated Decision Toggle\n```javascript\nWhen toggling automated_decision_making: true → false\nExpected: automated_explanation field also cleared\nValidation: Dependent field handling\n```\n\n### Test 9: Large Text Fields\n```javascript\nUpdate technical_measures with 5000+ character string\nExpected: Text stored and retrieved without truncation\nValidation: No character limit issues\n```\n\n## DELETE Operations Tests\n\n### Test 1: Successful Deletion\n```javascript\nDeletes: test-004 record\nExpected: Record removed, can no longer be queried\nValidation: DELETE operation works\n```\n\n### Test 2: Non-existent Record\n```javascript\nAttempts to delete non-existent ID\nExpected: RECORD_NOT_FOUND error\nValidation: Graceful error handling\n```\n\n### Test 3: Cross-Organization Access\n```javascript\nUser from org-999 attempts to delete org-001's record\nExpected: ACCESS_DENIED error\nValidation: Security - org isolation enforced\n```\n\n### Test 4-5: Verification\n```javascript\nVerifies record truly deleted and no orphaned references\nExpected: Record not found on subsequent reads\nValidation: Referential integrity maintained\n```\n\n## TABLE INTERACTIONS Tests\n\n### Test 1: Column Display\n```javascript\nExpected columns:\n- controller_name\n- processing_purpose\n- lawful_basis\n- legitimate_interests\n- retention_period\n- data_processor_name\n- next_review_date\n- status\n- actions\nValidation: All 9 columns rendered\n```\n\n### Test 2: Text Truncation\n```javascript\nContent > 50 chars should show ellipsis\nExpected: \"Very long text that exceeds...\"\nValidation: Hover tooltip shows full text (optional)\n```\n\n### Test 3: Date Formatting\n```javascript\nAll dates displayed as DD.MM.YYYY\nExample: 2025-11-09 → 09.11.2025\nValidation: Locale-aware formatting\n```\n\n### Test 4: Status Badges\n```javascript\n- active → green (status-success)\n- inactive → red (status-error)\n- under_review → yellow (status-warning)\n- suspended → red (status-error)\nValidation: CSS classes applied correctly\n```\n\n### Test 5: Action Buttons\n```javascript\nFor each row:\n- Edit button → opens modal with pre-filled data\n- Delete button → opens confirmation dialog\n- Download button → appears only if documentation_url exists\nValidation: All buttons functional\n```\n\n### Test 6: Stats Cards\n```javascript\nDisplay 4 stats:\n1. Total Records\n2. Active Records\n3. Total Data Loss Incidents\n4. Total Data Subject Requests\nValidation: Calculations correct\n```\n\n### Test 7: Empty State\n```javascript\nWhen no records exist:\nExpected: \"No records found\" message + Add button\nValidation: User not confused by blank table\n```\n\n### Test 8: Loading State\n```javascript\nWhile fetching data:\nExpected: Spinner visible, interactions disabled\nValidation: UX feedback provided\n```\n\n## FILTER & SORT Tests\n\n### Test 1: Status Filter\n```javascript\nFilter: status = \"active\"\nExpected: Only active records shown\nValidation: Filter works\n```\n\n### Test 2: Text Search\n```javascript\nFilter: controller_name contains \"Test\"\nExpected: \"Test Organization Ltd.\" appears\nValidation: Partial, case-insensitive search\n```\n\n### Test 3-4: Sorting\n```javascript\nSort by created_at (DESC): newest first\nSort by controller_name (ASC): A to Z\nValidation: Sort order correct\n```\n\n### Test 5: Combined Filters\n```javascript\nFilter by: status = \"active\" AND automated_decision_making = true\nExpected: Only records matching ALL criteria\nValidation: AND logic (not OR)\n```\n\n### Test 6: Filter Persistence\n```javascript\nSet filters → Reload page\nExpected: Filters maintained (URL params or localStorage)\nValidation: UX enhancement\n```\n\n## EDGE CASES Tests\n\n### Test 1: SQL Injection Prevention\n```javascript\nInput: \"'; DROP TABLE gdpr_consent_records; --\"\nExpected: Stored safely as plain text\nValidation: SQL injection prevented\n```\n\n### Test 2: XSS Prevention\n```javascript\nInput: \"<script>alert('XSS')</script>\"\nExpected: Stored as-is, displayed as: &lt;script&gt;...&lt;/script&gt;\nValidation: Output encoding\n```\n\n### Test 3: Field Length Validation\n```javascript\nInput: 10,000 character string\nExpected: Either truncated to max length or FIELD_TOO_LONG error\nValidation: Database constraints enforced\n```\n\n### Test 4: Null/Undefined Handling\n```javascript\nInput: null or undefined values in optional fields\nExpected: Converted to empty string or null safely\nValidation: No \"undefined\" or \"null\" strings in UI\n```\n\n### Test 5: Concurrent Operations\n```javascript\n5 simultaneous create requests\nExpected: All 5 records created, no conflicts\nValidation: Race conditions prevented\n```\n\n### Test 6-7: Error Handling\n```javascript\nNetwork timeout → Show error, allow retry\nDB connection error → Graceful degradation\nValidation: User experience maintained\n```\n\n## DATA INTEGRITY Tests\n\n### Test 1: Update Consistency\n```javascript\nCreate → Read → Update → Read\nExpected: Final read shows updated values\nValidation: ACID compliance\n```\n\n### Test 2-5: Data Type Preservation\n```javascript\nDates: \"2025-10-15\" stored as date (not string)\nNumbers: 42 stays 42 (not \"42\")\nBooleans: true/false (not 0/1)\nValidation: Type safety\n```\n\n### Test 6: Primary Key Uniqueness\n```javascript\nAttempt to create two records with same ID\nExpected: Second insert fails with DUPLICATE_PRIMARY_KEY\nValidation: Uniqueness enforced\n```\n\n## Running the Tests\n\n### Jest\n```bash\n# Run all tests\nyarn test\n\n# Run specific test suite\nyard test GDPRProcessingActivitiesRecord\n\n# Run with coverage\nyarn test --coverage\n\n# Watch mode\nyarn test --watch\n```\n\n### Vitest\n```bash\n# Run all tests\nvitest\n\n# Run specific file\nvitest GDPRProcessingActivitiesRecord.test.ts\n\n# Coverage\nvitest --coverage\n```\n\n### Playwright (E2E)\n```bash\n# Run all tests\nplaywright test\n\n# Run specific test file\nplaywright test tests/gdpr.spec.ts\n\n# Debug mode\nplaywright test --debug\n\n# UI mode\nplaywright test --ui\n```\n\n## Manual Testing Checklist\n\nSee **Section: EXAMPLE 5: Manual Testing Checklist** in `src/tests/GDPRProcessingActivitiesRecord.examples.ts` for complete manual testing procedures.\n\n### Quick Manual Test\n1. Navigate to GDPR → Evidence obdelav\n2. Click \"Add\" → Fill form → Save\n3. Verify record appears in table\n4. Click edit → Change status → Update\n5. Click delete → Confirm → Record removed\n6. Test filters and sorting\n7. Check responsive design on mobile\n\n## Expected Test Results\n\n### Success Criteria\n- ✓ All 55 tests pass\n- ✓ No console errors or warnings\n- ✓ No XSS or SQL injection vulnerabilities\n- ✓ Performance: table loads <1 second with 100 records\n- ✓ UI responsive on mobile/tablet/desktop\n- ✓ Accessibility: keyboard navigable, screen reader compatible\n- ✓ Data persists correctly across operations\n\n### Coverage Metrics\n- Line coverage: > 90%\n- Branch coverage: > 85%\n- Function coverage: 100%\n\n## Troubleshooting\n\n### Common Issues\n\n**Issue:** \"Organizacijski kontekst ni na voljo\"\n- **Cause:** User profile not loaded\n- **Fix:** Ensure user is authenticated, profile table populated\n\n**Issue:** \"No records found\"\n- **Cause:** Organization filter filtering out all data\n- **Fix:** Check organization_id in both records and user profile\n\n**Issue:** Status badge showing wrong color\n- **Cause:** CSS class not applied\n- **Fix:** Check Tailwind CSS build includes `status-*` classes\n\n**Issue:** Dates showing as \"Invalid Date\"\n- **Cause:** Date format mismatch\n- **Fix:** Ensure dates in YYYY-MM-DD format before storing\n\n## Contributing\n\nWhen adding new features to GDPRProcessingActivitiesRecord:\n\n1. Add corresponding test cases to `GDPRProcessingActivitiesRecord.test.ts`\n2. Update test examples in `GDPRProcessingActivitiesRecord.examples.ts`\n3. Update this TESTING_GUIDE.md\n4. Ensure all tests pass before merging\n5. Maintain >85% code coverage\n\n## References\n\n- **Component:** `src/components/gdpr/GDPRProcessingActivitiesRecord.tsx`\n- **Add Modal:** `src/components/modals/GDPRProcessingActivitiesRecordAddModal.tsx`\n- **Database Table:** `gdpr_consent_records`\n- **Related:** GDPR compliance, data protection regulations\n\n## Support\n\nFor questions or issues with testing:\n1. Check this guide's Troubleshooting section\n2. Review test examples in `GDPRProcessingActivitiesRecord.examples.ts`\n3. Check console logs for specific error messages\n4. Review Supabase dashboard for data verification\n\n---\n\n**Last Updated:** November 9, 2025\n**Test Suite Version:** 1.0\n**Coverage:** 55 test cases across 8 categories\n